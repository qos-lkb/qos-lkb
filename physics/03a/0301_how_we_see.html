<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…‰ç·šé€²å…¥çœ¼ç›æ¨¡æ“¬å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾© Canvas æ¨£å¼ä»¥ç¢ºä¿æ¸…æ™°åº¦ */
        canvas {
            border: 1px solid #e5e7eb;
            background-color: #111827; /* æ·±è‰²èƒŒæ™¯æ¨¡æ“¬æš—å®¤ */
            border-radius: 0.5rem;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            cursor: pointer;
            border-radius: 50%;
        }
        /* Modal Canvas ç‰¹æ®Šæ¨£å¼ï¼šç™½è‰²èƒŒæ™¯ */
        #eyeModalCanvas {
            background-color: #ffffff;
            border: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-lg sticky top-0 z-10">
        <div class="max-w-6xl mx-auto flex items-center justify-between">
            <h1 class="text-xl md:text-2xl font-bold flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                <span id="app-title">ç‰©ç†æ•™å®¤ï¼šå…‰ç·šèˆ‡è¦–è¦º</span>
            </h1>
            
            <div class="flex items-center gap-3">
                <!-- Experiment Explanation Button (Moved here) -->
                <button onclick="toggleModal(true)" class="hidden md:flex items-center gap-1 bg-blue-700 hover:bg-blue-800 px-3 py-1.5 rounded-lg text-sm font-medium transition border border-blue-500">
                    <span>ğŸ“–</span> <span id="btn-explain">å¯¦é©—è§£èªª</span>
                </button>
                <!-- Mobile Icon for Explanation -->
                <button onclick="toggleModal(true)" class="md:hidden p-2 bg-blue-700 hover:bg-blue-800 rounded-lg transition border border-blue-500">
                    ğŸ“–
                </button>

                <!-- Language Toggle -->
                <button onclick="toggleLanguage()" class="bg-white text-blue-700 hover:bg-gray-100 px-3 py-1.5 rounded-lg text-sm font-bold transition shadow-sm border border-blue-200 min-w-[80px]">
                    ä¸­ / Eng
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow p-4 md:p-8 max-w-6xl mx-auto w-full grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Controls Panel -->
        <div class="bg-white p-6 rounded-xl shadow-md space-y-6 h-fit border border-gray-200 lg:col-span-1">
            <h2 id="settings-title" class="text-xl font-semibold border-b pb-2 text-gray-700">å¯¦é©—åƒæ•¸è¨­å®š</h2>

            <!-- Control 1: Object Type -->
            <div class="space-y-2">
                <label id="label-obj-type" class="block text-sm font-medium text-gray-700">1. ç‰©é«”æ€§è³ª</label>
                <div class="flex gap-2">
                    <button id="btn-luminous" onclick="setObjectType('luminous')" class="flex-1 py-2 px-3 rounded-lg border-2 border-yellow-500 bg-yellow-50 text-yellow-700 font-medium hover:bg-yellow-100 transition focus:outline-none focus:ring-2 focus:ring-yellow-500">
                        ğŸ•¯ï¸ ç™¼å…‰é«”
                    </button>
                    <button id="btn-nonluminous" onclick="setObjectType('non-luminous')" class="flex-1 py-2 px-3 rounded-lg border-2 border-gray-300 bg-gray-50 text-gray-600 font-medium hover:bg-gray-100 transition focus:outline-none focus:ring-2 focus:ring-gray-400">
                        ğŸ éç™¼å…‰é«”
                    </button>
                </div>
                <p id="type-desc" class="text-xs text-gray-500 mt-1">
                    ç™¼å…‰é«”æœƒè‡ªè¡Œç™¼å‡ºå…‰ç·šï¼ˆä¾‹å¦‚ï¼šè Ÿç‡­ã€å¤ªé™½ï¼‰ã€‚
                </p>
            </div>

            <!-- Control 2: Distance -->
            <div class="space-y-3">
                <div class="flex justify-between items-center">
                    <label id="label-distance" class="block text-sm font-medium text-gray-700">2. ç‰©é«”è·é›¢</label>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="infinite-toggle" onchange="toggleInfinite()" class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                        <label id="label-infinite" for="infinite-toggle" class="text-sm text-blue-600 font-semibold cursor-pointer select-none">è¨­ç‚ºç„¡é™é </label>
                    </div>
                </div>
                <input type="range" id="distance-slider" min="50" max="600" value="300" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb" oninput="updateSimulation()">
                <div class="flex justify-between text-xs text-gray-500">
                    <span id="label-near">è¿‘</span>
                    <span id="distance-value">300cm</span>
                    <span id="label-far">é </span>
                </div>
            </div>

            <!-- Control 3: Pupil Size -->
            <div class="space-y-3">
                <label id="label-pupil" class="block text-sm font-medium text-gray-700">3. çœ¼ç›ç›´å¾‘ (ç³å­”å¤§å°)</label>
                <input type="range" id="pupil-slider" min="10" max="80" value="30" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb" oninput="updateSimulation()">
                <div class="flex justify-between text-xs text-gray-500">
                    <span id="label-small-cone">å°å…‰éŒ</span>
                    <span id="pupil-value">30mm</span>
                    <span id="label-large-cone">å¤§å…‰éŒ</span>
                </div>
                <div class="bg-blue-50 p-3 rounded text-sm text-blue-800 border border-blue-100">
                    <strong id="concept-title" class="block mb-1">ğŸ’¡ ç‰©ç†æ¦‚å¿µï¼šå…‰éŒ</strong>
                    <span id="concept-text">ç‰©é«”ç™¼å‡ºçš„å…‰æ˜¯å‘å››é¢å…«æ–¹æ“´æ•£çš„ï¼Œä½†åªæœ‰å°„å…¥ç³å­”ç¯„åœå…§çš„å…‰ç·šï¼ˆé»ƒè‰²å€åŸŸï¼‰æ‰èƒ½è¢«æˆ‘å€‘çœ‹è¦‹ã€‚</span>
                </div>
            </div>
        </div>

        <!-- Simulation Canvas -->
        <div class="lg:col-span-2 flex flex-col gap-4">
            <div class="relative w-full aspect-[16/9] bg-gray-900 rounded-xl overflow-hidden shadow-inner border border-gray-700">
                <canvas id="simCanvas" class="absolute top-0 left-0 w-full h-full"></canvas>
                
                <!-- Overlay Labels (Optional for better accessibility) -->
                <div class="absolute bottom-4 right-4 text-white/50 text-sm pointer-events-none select-none">
                    Simulation
                </div>
            </div>
            
            <!-- Observation Panel -->
            <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-200">
                <h3 id="obs-title" class="font-bold text-gray-800 mb-2">è§€å¯Ÿé‡é»ï¼š</h3>
                <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
                    <li id="obs-1">å…‰ç·šä»¥ç›´ç·šå‚³æ’­é€²å…¥çœ¼ç›ã€‚</li>
                    <li id="obs-2">ç‰©é«”è·é›¢è¶Šé ï¼Œé€²å…¥çœ¼ç›çš„å…‰ç·šå¤¾è§’è¶Šå°ã€‚</li>
                    <li id="obs-3">ç³å­”è¶Šå¤§ï¼Œæ”¶é›†åˆ°çš„å…‰ç·šè¶Šå¤šï¼ˆå…‰éŒè¶Šå¯¬ï¼‰ã€‚</li>
                </ul>
            </div>
        </div>
    </main>

    <!-- Modal Overlay -->
    <div id="info-modal" class="fixed inset-0 bg-black/60 z-50 hidden flex items-center justify-center backdrop-blur-sm transition-opacity opacity-0">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden transform transition-all scale-95 flex flex-col max-h-[90vh]">
            <!-- Modal Header -->
            <div class="bg-indigo-600 p-4 flex justify-between items-center text-white flex-shrink-0">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <span>ğŸ“</span> <span id="modal-title">ç‰©è·èˆ‡å…‰éŒç™¼æ•£</span>
                </h3>
                <button onclick="toggleModal(false)" class="hover:bg-indigo-700 p-1 rounded-full transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div class="p-6 space-y-4 text-gray-700 overflow-y-auto">
                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100">
                    <h4 id="modal-q1" class="font-bold text-indigo-900 mb-2">ç‚ºä»€éº¼è·é›¢æœƒå½±éŸ¿å…‰éŒå½¢ç‹€ï¼Ÿ</h4>
                    <p id="modal-a1" class="text-sm leading-relaxed">
                        ç•¶ç‰©é«”è·é›¢çœ¼ç›ä¸åŒæ™‚ï¼Œèƒ½å¤ é€²å…¥ç³å­”çš„å…‰ç·šè§’åº¦ï¼ˆç™¼æ•£è§’ï¼‰æœƒç™¼ç”Ÿè®ŠåŒ–ã€‚<strong>è·é›¢æ„ˆé ï¼Œé€²å…¥çœ¼ç›çš„å…‰ç·šç™¼æ•£è§’åº¦æ„ˆå°ã€‚</strong>
                    </p>
                </div>

                <!-- Frontal Eye Diagram -->
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 flex flex-col items-center shadow-sm">
                    <h5 id="eye-front-title" class="text-sm font-bold text-gray-700 mb-2 self-start w-full border-b pb-1">ğŸ‘ï¸ çœ¼ç›æ§‹é€ æ­£é¢åœ– (ç¤ºæ„)</h5>
                    <canvas id="eyeModalCanvas" width="300" height="150" class="w-full max-w-[300px]"></canvas>
                    <p class="text-xs text-gray-500 mt-2 text-center">
                        <span class="inline-block w-3 h-3 bg-gray-800 rounded-full align-middle mr-1"></span><span id="eye-front-pupil"><strong>ç³å­” (Pupil)</strong>ï¼šä½æ–¼ä¸­å¤®çš„é»‘è‰²åœ“å½¢é–‹å­”ï¼Œå…‰ç·šç”±æ­¤é€²å…¥ã€‚</span><br>
                        <span class="inline-block w-3 h-3 bg-blue-400 rounded-full align-middle mr-1"></span><span id="eye-front-iris"><strong>è™¹è†œ (Iris)</strong>ï¼šæœ‰é¡è‰²çš„è‚Œè‚‰çµ„ç¹”ï¼Œæ§åˆ¶ç³å­”å¤§å°ã€‚</span>
                    </p>
                </div>

                <div class="space-y-4">
                    <div class="flex gap-4 items-start">
                        <div class="w-12 h-12 flex-shrink-0 bg-yellow-100 rounded-full flex items-center justify-center text-xl shadow-sm">ğŸ”¦</div>
                        <div>
                            <strong id="modal-short-dist-title" class="block text-gray-900">è¿‘è™•ç‰©é«” (Short Distance)</strong>
                            <p id="modal-short-dist-desc" class="text-sm text-gray-600 mt-1">
                                è·é›¢è¼ƒè¿‘æ™‚ï¼Œå…‰ç·šé€²å…¥çœ¼ç›çš„<strong>ç™¼æ•£è§’åº¦è¼ƒå¤§</strong>ã€‚å…‰ç·šéœ€è¦ä»¥è¼ƒå¤§çš„å¼µè§’æ‰èƒ½å‰›å¥½é€²å…¥ç³å­”ï¼Œå…‰éŒçœ‹èµ·ä¾†è¼ƒã€Œèƒ–ã€ã€‚
                            </p>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <div class="w-12 h-12 flex-shrink-0 bg-blue-100 rounded-full flex items-center justify-center text-xl shadow-sm">ğŸ”­</div>
                        <div>
                            <strong id="modal-long-dist-title" class="block text-gray-900">é è™•ç‰©é«” (Long Distance)</strong>
                            <p id="modal-long-dist-desc" class="text-sm text-gray-600 mt-1">
                                è·é›¢æ„ˆé ï¼Œå…‰ç·šé€²å…¥çœ¼ç›çš„<strong>ç™¼æ•£è§’åº¦æ„ˆå°</strong>ã€‚å…‰ç·šçœ‹èµ·ä¾†è¶Šä¾†è¶Šã€Œç›´ã€ï¼Œå½¼æ­¤ä¹‹é–“çš„å¤¾è§’é¡¯è‘—è®Šå°ã€‚
                            </p>
                        </div>
                    </div>

                    <div class="flex gap-4 items-start">
                        <div class="w-12 h-12 flex-shrink-0 bg-gray-100 rounded-full flex items-center justify-center text-xl shadow-sm">â™¾ï¸</div>
                        <div>
                            <strong id="modal-infinite-title" class="block text-gray-900">ç„¡é™é  (Infinite)</strong>
                            <p id="modal-infinite-desc" class="text-sm text-gray-600 mt-1">
                                ç•¶ç‰©é«”ä½æ–¼ç„¡é™é æ™‚ï¼Œç™¼æ•£è§’åº¦è¶¨è¿‘æ–¼<strong>é›¶</strong>ï¼Œé€²å…¥çœ¼ç›çš„å…‰ç·šè¦–ç‚º<strong>å¹³è¡Œå…‰</strong>ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="bg-gray-50 p-4 flex justify-end flex-shrink-0">
                <button id="modal-close" onclick="toggleModal(false)" class="px-5 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg font-medium transition">
                    æ˜ç™½äº†
                </button>
            </div>
        </div>
    </div>

    <script>
        // Language Data
        const translations = {
            zh: {
                appTitle: "ç‰©ç†æ•™å®¤ï¼šå…‰ç·šèˆ‡è¦–è¦º",
                btnExplain: "å¯¦é©—è§£èªª",
                settingsTitle: "å¯¦é©—åƒæ•¸è¨­å®š",
                labelObjType: "1. ç‰©é«”æ€§è³ª",
                btnLuminous: "ğŸ•¯ï¸ ç™¼å…‰é«”",
                btnNonLuminous: "ğŸ éç™¼å…‰é«”",
                descLuminous: "ç™¼å…‰é«”æœƒè‡ªè¡Œç™¼å‡ºå…‰ç·šï¼ˆä¾‹å¦‚ï¼šè Ÿç‡­ã€å¤ªé™½ï¼‰ã€‚å…‰ç·šå¾ç‰©é«”ç›´æ¥å°„å‘çœ¼ç›ã€‚",
                descNonLuminous: "éç™¼å…‰é«”æœ¬èº«ä¸ç™¼å…‰ï¼ˆä¾‹å¦‚ï¼šè˜‹æœï¼‰ã€‚éœ€è¦å¤–éƒ¨å…‰æºç…§å°„ï¼Œåå°„çš„å…‰ç·šé€²å…¥çœ¼ç›æ‰èƒ½è¢«çœ‹è¦‹ã€‚",
                labelDistance: "2. ç‰©é«”è·é›¢",
                labelInfinite: "è¨­ç‚ºç„¡é™é ",
                labelPupil: "3. çœ¼ç›ç›´å¾‘ (ç³å­”å¤§å°)",
                labelNear: "è¿‘",
                labelFar: "é ",
                labelSmallCone: "å°å…‰éŒ",
                labelLargeCone: "å¤§å…‰éŒ",
                conceptTitle: "ğŸ’¡ ç‰©ç†æ¦‚å¿µï¼šå…‰éŒ",
                conceptFinite: "ç‰©é«”ç™¼å‡ºçš„å…‰æ˜¯å‘å››é¢å…«æ–¹æ“´æ•£çš„ï¼Œä½†åªæœ‰å°„å…¥ç³å­”ç¯„åœå…§çš„å…‰ç·šï¼ˆé»ƒè‰²å€åŸŸï¼‰æ‰èƒ½è¢«æˆ‘å€‘çœ‹è¦‹ã€‚",
                conceptInfinite: "ç•¶ç‰©é«”ä½æ–¼ç„¡é™é æ™‚ï¼Œåˆ°é”çœ¼ç›çš„å…‰ç·šå¹¾ä¹æ˜¯å¹³è¡Œçš„ã€‚",
                obsTitle: "è§€å¯Ÿé‡é»ï¼š",
                obs1: "å…‰ç·šä»¥ç›´ç·šå‚³æ’­é€²å…¥çœ¼ç›ã€‚",
                obs2: "ç‰©é«”è·é›¢è¶Šé ï¼Œé€²å…¥çœ¼ç›çš„å…‰ç·šå¤¾è§’è¶Šå°ã€‚",
                obs3: "ç³å­”è¶Šå¤§ï¼Œæ”¶é›†åˆ°çš„å…‰ç·šè¶Šå¤šï¼ˆå…‰éŒè¶Šå¯¬ï¼‰ã€‚",
                distanceInfinite: "ç„¡é™é ",
                
                // Canvas Labels
                canvasLightSource: "å…‰æº",
                canvasObjectLuminous: "ç™¼å…‰é«”",
                canvasObjectNonLuminous: "éç™¼å…‰é«”",
                canvasInfiniteHint: "ä¾†è‡ªç„¡é™é çš„å…‰æº (å¦‚: æ˜Ÿæ˜Ÿ)",
                canvasRetina: "è¦–ç¶²è†œ",
                canvasPupil: "ç³å­”",
                
                // Modal
                modalTitle: "ç‰©è·èˆ‡å…‰éŒç™¼æ•£",
                modalQ1: "ç‚ºä»€éº¼è·é›¢æœƒå½±éŸ¿å…‰éŒå½¢ç‹€ï¼Ÿ",
                modalA1: "ç•¶ç‰©é«”è·é›¢çœ¼ç›ä¸åŒæ™‚ï¼Œèƒ½å¤ é€²å…¥ç³å­”çš„å…‰ç·šè§’åº¦ï¼ˆç™¼æ•£è§’ï¼‰æœƒç™¼ç”Ÿè®ŠåŒ–ã€‚<strong>è·é›¢æ„ˆé ï¼Œé€²å…¥çœ¼ç›çš„å…‰ç·šç™¼æ•£è§’åº¦æ„ˆå°ã€‚</strong>",
                eyeFrontTitle: "ğŸ‘ï¸ çœ¼ç›æ§‹é€ æ­£é¢åœ– (ç¤ºæ„)",
                eyeFrontPupil: "<strong>ç³å­” (Pupil)</strong>ï¼šä½æ–¼ä¸­å¤®çš„é»‘è‰²åœ“å½¢é–‹å­”ï¼Œå…‰ç·šç”±æ­¤é€²å…¥ã€‚",
                eyeFrontIris: "<strong>è™¹è†œ (Iris)</strong>ï¼šæœ‰é¡è‰²çš„è‚Œè‚‰çµ„ç¹”ï¼Œæ§åˆ¶ç³å­”å¤§å°ã€‚",
                modalShortDistTitle: "è¿‘è™•ç‰©é«” (Short Distance)",
                modalShortDistDesc: "è·é›¢è¼ƒè¿‘æ™‚ï¼Œå…‰ç·šé€²å…¥çœ¼ç›çš„<strong>ç™¼æ•£è§’åº¦è¼ƒå¤§</strong>ã€‚å…‰ç·šéœ€è¦ä»¥è¼ƒå¤§çš„å¼µè§’æ‰èƒ½å‰›å¥½é€²å…¥ç³å­”ï¼Œå…‰éŒçœ‹èµ·ä¾†è¼ƒã€Œèƒ–ã€ã€‚",
                modalLongDistTitle: "é è™•ç‰©é«” (Long Distance)",
                modalLongDistDesc: "è·é›¢æ„ˆé ï¼Œå…‰ç·šé€²å…¥çœ¼ç›çš„<strong>ç™¼æ•£è§’åº¦æ„ˆå°</strong>ã€‚å…‰ç·šçœ‹èµ·ä¾†è¶Šä¾†è¶Šã€Œç›´ã€ï¼Œå½¼æ­¤ä¹‹é–“çš„å¤¾è§’é¡¯è‘—è®Šå°ã€‚",
                modalInfiniteTitle: "ç„¡é™é  (Infinite)",
                modalInfiniteDesc: "ç•¶ç‰©é«”ä½æ–¼ç„¡é™é æ™‚ï¼Œç™¼æ•£è§’åº¦è¶¨è¿‘æ–¼<strong>é›¶</strong>ï¼Œé€²å…¥çœ¼ç›çš„å…‰ç·šè¦–ç‚º<strong>å¹³è¡Œå…‰</strong>ã€‚",
                modalClose: "æ˜ç™½äº†",
                modalPupilLabel: "ç³å­” (åœ“å½¢)"
            },
            en: {
                appTitle: "Physics Lab: Light & Vision",
                btnExplain: "Explanation",
                settingsTitle: "Parameters",
                labelObjType: "1. Object Type",
                btnLuminous: "ğŸ•¯ï¸ Luminous",
                btnNonLuminous: "ğŸ Non-luminous",
                descLuminous: "Luminous objects emit their own light (e.g., Candle, Sun). Light travels directly to the eye.",
                descNonLuminous: "Non-luminous objects (e.g., Apple) do not emit light. They reflect light from a source into the eye.",
                labelDistance: "2. Object Distance",
                labelInfinite: "Infinite Distance",
                labelPupil: "3. Pupil Diameter",
                labelNear: "Near",
                labelFar: "Far",
                labelSmallCone: "Small",
                labelLargeCone: "Large",
                conceptTitle: "ğŸ’¡ Concept: Cone of Rays",
                conceptFinite: "Light spreads in all directions, but only rays entering the pupil (yellow area) are visible.",
                conceptInfinite: "When the object is at infinity, light rays reaching the eye are effectively parallel.",
                obsTitle: "Key Observations:",
                obs1: "Light travels in straight lines into the eye.",
                obs2: "The further the object, the smaller the angle of light entering the eye.",
                obs3: "A larger pupil collects more light (wider cone of rays).",
                distanceInfinite: "Infinite",

                // Canvas Labels
                canvasLightSource: "Light Source",
                canvasObjectLuminous: "Luminous",
                canvasObjectNonLuminous: "Non-luminous",
                canvasInfiniteHint: "Light from infinity (e.g. Stars)",
                canvasRetina: "Retina",
                canvasPupil: "Pupil",
                
                // Modal
                modalTitle: "Distance & Divergence",
                modalQ1: "How does distance affect the cone of rays?",
                modalA1: "The angle of light entering the pupil changes with distance. <strong>The further the object, the smaller the angle of divergence.</strong>",
                eyeFrontTitle: "ğŸ‘ï¸ Front View of Eye (Diagram)",
                eyeFrontPupil: "<strong>Pupil</strong>: The black circular opening in the center where light enters.",
                eyeFrontIris: "<strong>Iris</strong>: The colored tissue regulating pupil size.",
                modalShortDistTitle: "Short Distance",
                modalShortDistDesc: "At close range, light enters at a <strong>larger angle</strong>. The cone of rays appears 'wider'.",
                modalLongDistTitle: "Long Distance",
                modalLongDistDesc: "As distance increases, the angle <strong>decreases</strong>. Rays become straighter and the angle narrows.",
                modalInfiniteTitle: "Infinite Distance",
                modalInfiniteDesc: "At infinite distance, the angle is near <strong>zero</strong>. Rays are considered <strong>parallel</strong>.",
                modalClose: "Got it",
                modalPupilLabel: "Pupil (Circular)"
            }
        };

        // State
        const state = {
            objectType: 'luminous', // 'luminous' or 'non-luminous'
            distance: 300,
            isInfinite: false,
            pupilSize: 30,
            canvasWidth: 800,
            canvasHeight: 450,
            isDragging: false,
            lang: 'zh'
        };

        // DOM Elements
        const canvas = document.getElementById('simCanvas');
        const ctx = canvas.getContext('2d');
        const distanceSlider = document.getElementById('distance-slider');
        const distanceValue = document.getElementById('distance-value');
        const pupilSlider = document.getElementById('pupil-slider');
        const pupilValue = document.getElementById('pupil-value');
        const infiniteToggle = document.getElementById('infinite-toggle');
        const btnLuminous = document.getElementById('btn-luminous');
        const btnNonLuminous = document.getElementById('btn-nonluminous');
        const typeDesc = document.getElementById('type-desc');
        const conceptText = document.getElementById('concept-text');
        
        // Helper to get text based on current language
        function t(key) {
            return translations[state.lang][key];
        }

        // Language Toggle Logic
        function toggleLanguage() {
            state.lang = state.lang === 'zh' ? 'en' : 'zh';
            updateAllText();
            updateSimulation(); // Redraw canvas with new text
            requestAnimationFrame(drawEyeFront); // Redraw modal canvas
        }

        function updateAllText() {
            // Header
            document.getElementById('app-title').textContent = t('appTitle');
            document.getElementById('btn-explain').textContent = t('btnExplain');
            
            // Settings
            document.getElementById('settings-title').textContent = t('settingsTitle');
            document.getElementById('label-obj-type').textContent = t('labelObjType');
            document.getElementById('btn-luminous').textContent = t('btnLuminous');
            document.getElementById('btn-nonluminous').textContent = t('btnNonLuminous');
            
            // Logic-based text (re-run logic)
            if (state.objectType === 'luminous') {
                typeDesc.textContent = t('descLuminous');
            } else {
                typeDesc.textContent = t('descNonLuminous');
            }

            document.getElementById('label-distance').textContent = t('labelDistance');
            document.getElementById('label-infinite').textContent = t('labelInfinite');
            document.getElementById('label-near').textContent = t('labelNear');
            document.getElementById('label-far').textContent = t('labelFar');

            document.getElementById('label-pupil').textContent = t('labelPupil');
            document.getElementById('label-small-cone').textContent = t('labelSmallCone');
            document.getElementById('label-large-cone').textContent = t('labelLargeCone');
            
            document.getElementById('concept-title').textContent = t('conceptTitle');
            // Logic-based concept text
            if (state.isInfinite) {
                conceptText.textContent = t('conceptInfinite');
            } else {
                conceptText.textContent = t('conceptFinite');
            }

            // Observations
            document.getElementById('obs-title').textContent = t('obsTitle');
            document.getElementById('obs-1').textContent = t('obs1');
            document.getElementById('obs-2').textContent = t('obs2');
            document.getElementById('obs-3').textContent = t('obs3');

            // Modal
            document.getElementById('modal-title').textContent = t('modalTitle');
            document.getElementById('modal-q1').textContent = t('modalQ1');
            document.getElementById('modal-a1').innerHTML = t('modalA1');
            document.getElementById('eye-front-title').textContent = t('eyeFrontTitle');
            document.getElementById('eye-front-pupil').innerHTML = t('eyeFrontPupil');
            document.getElementById('eye-front-iris').innerHTML = t('eyeFrontIris');
            document.getElementById('modal-short-dist-title').textContent = t('modalShortDistTitle');
            document.getElementById('modal-short-dist-desc').innerHTML = t('modalShortDistDesc');
            document.getElementById('modal-long-dist-title').textContent = t('modalLongDistTitle');
            document.getElementById('modal-long-dist-desc').innerHTML = t('modalLongDistDesc');
            document.getElementById('modal-infinite-title').textContent = t('modalInfiniteTitle');
            document.getElementById('modal-infinite-desc').innerHTML = t('modalInfiniteDesc');
            document.getElementById('modal-close').textContent = t('modalClose');
        }

        // Modal Logic
        const modal = document.getElementById('info-modal');
        const modalContent = modal.querySelector('div');

        function toggleModal(show) {
            if (show) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                }, 10);
                requestAnimationFrame(drawEyeFront);
            } else {
                modal.classList.add('opacity-0');
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }

        function drawEyeFront() {
            const c = document.getElementById('eyeModalCanvas');
            if(!c) return;
            const context = c.getContext('2d');
            const w = c.width;
            const h = c.height;
            const cx = w / 2;
            const cy = h / 2;

            context.clearRect(0, 0, w, h);

            // 1. Sclera
            context.beginPath();
            context.ellipse(cx, cy, 70, 45, 0, 0, Math.PI * 2);
            context.fillStyle = "#F3F4F6";
            context.fill();
            context.lineWidth = 1;
            context.strokeStyle = "#D1D5DB";
            context.stroke();

            // 2. Iris
            context.beginPath();
            context.arc(cx, cy, 32, 0, Math.PI * 2);
            context.fillStyle = "#60A5FA";
            context.fill();
            context.strokeStyle = "rgba(255,255,255,0.3)";
            context.lineWidth = 1;
            for(let i=0; i<12; i++) {
                context.beginPath();
                context.moveTo(cx, cy);
                context.lineTo(cx + Math.cos(i*Math.PI/6)*32, cy + Math.sin(i*Math.PI/6)*32);
                context.stroke();
            }

            // 3. Pupil
            const demoPupilSize = 15;
            context.beginPath();
            context.arc(cx, cy, demoPupilSize, 0, Math.PI * 2);
            context.fillStyle = "#1F2937";
            context.fill();

            // 4. Highlight
            context.beginPath();
            context.arc(cx + 8, cy - 8, 4, 0, Math.PI * 2);
            context.fillStyle = "rgba(255,255,255,0.6)";
            context.fill();

            // 5. Label
            context.strokeStyle = "#4B5563";
            context.lineWidth = 1.5;
            context.font = "12px Arial";
            context.fillStyle = "#374151";

            context.beginPath();
            context.moveTo(cx, cy);
            context.lineTo(cx + 60, cy - 30);
            context.lineTo(cx + 90, cy - 30);
            context.stroke();
            
            // Translate label inside canvas
            context.fillText(t('modalPupilLabel'), cx + 95, cy - 26);
        }

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) toggleModal(false);
        });

        // Initialization
        function init() {
            canvas.width = state.canvasWidth;
            canvas.height = state.canvasHeight;
            
            // Add Drag Event Listeners
            canvas.addEventListener('mousedown', handleStart);
            canvas.addEventListener('mousemove', handleMove);
            window.addEventListener('mouseup', handleEnd);
            
            canvas.addEventListener('touchstart', handleStart, {passive: false});
            canvas.addEventListener('touchmove', handleMove, {passive: false});
            window.addEventListener('touchend', handleEnd);

            updateSimulation();
        }

        // Interaction Handlers (Drag & Drop)
        function getMousePos(evt) {
            const rect = canvas.getBoundingClientRect();
            const clientX = evt.clientX || (evt.touches && evt.touches[0].clientX);
            const clientY = evt.clientY || (evt.touches && evt.touches[0].clientY);
            
            if (clientX === undefined) return { x: 0, y: 0 };

            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            return {
                x: (clientX - rect.left) * scaleX,
                y: (clientY - rect.top) * scaleY
            };
        }

        function isMouseOverObject(pos) {
            if (state.isInfinite) return false;
            
            const eyeX = canvas.width - 100;
            const objectX = eyeX - state.distance;
            const objectY = canvas.height / 2;
            
            const dx = pos.x - objectX;
            const dy = pos.y - objectY;
            return (dx * dx + dy * dy) < 3600;
        }

        function handleStart(e) {
            const pos = getMousePos(e);
            if (isMouseOverObject(pos)) {
                state.isDragging = true;
                if (e.type === 'touchstart') e.preventDefault();
                canvas.style.cursor = 'grabbing';
            }
        }

        function handleMove(e) {
            const pos = getMousePos(e);
            
            if (!state.isDragging) {
                if (isMouseOverObject(pos)) {
                    canvas.style.cursor = 'grab';
                } else {
                    canvas.style.cursor = 'default';
                }
                return;
            }

            if (state.isDragging) {
                if (e.type === 'touchmove') e.preventDefault();
                
                const eyeX = canvas.width - 100;
                let newDist = eyeX - pos.x;
                
                const min = parseInt(distanceSlider.min);
                const max = parseInt(distanceSlider.max);
                
                if (newDist < min) newDist = min;
                if (newDist > max) newDist = max;
                
                distanceSlider.value = Math.round(newDist);
                updateSimulation();
            }
        }

        function handleEnd(e) {
            if (state.isDragging) {
                state.isDragging = false;
                canvas.style.cursor = 'grab';
            }
        }

        // Action Handlers
        function setObjectType(type) {
            state.objectType = type;
            
            if (type === 'luminous') {
                btnLuminous.classList.remove('border-gray-300', 'bg-gray-50', 'text-gray-600');
                btnLuminous.classList.add('border-yellow-500', 'bg-yellow-50', 'text-yellow-700');
                
                btnNonLuminous.classList.remove('border-red-500', 'bg-red-50', 'text-red-700');
                btnNonLuminous.classList.add('border-gray-300', 'bg-gray-50', 'text-gray-600');
                
                typeDesc.textContent = t('descLuminous');
            } else {
                btnNonLuminous.classList.remove('border-gray-300', 'bg-gray-50', 'text-gray-600');
                btnNonLuminous.classList.add('border-red-500', 'bg-red-50', 'text-red-700');
                
                btnLuminous.classList.remove('border-yellow-500', 'bg-yellow-50', 'text-yellow-700');
                btnLuminous.classList.add('border-gray-300', 'bg-gray-50', 'text-gray-600');
                
                typeDesc.textContent = t('descNonLuminous');
            }
            updateSimulation();
        }

        function toggleInfinite() {
            state.isInfinite = infiniteToggle.checked;
            distanceSlider.disabled = state.isInfinite;
            distanceSlider.parentElement.style.opacity = state.isInfinite ? '0.5' : '1';
            
            if (state.isInfinite) {
                conceptText.textContent = t('conceptInfinite');
            } else {
                conceptText.textContent = t('conceptFinite');
            }
            
            updateSimulation();
        }

        function updateSimulation() {
            if (!state.isInfinite) {
                state.distance = parseInt(distanceSlider.value);
                distanceValue.textContent = state.distance + "cm";
            } else {
                distanceValue.textContent = t('distanceInfinite');
            }
            
            state.pupilSize = parseInt(pupilSlider.value);
            pupilValue.textContent = state.pupilSize + "mm";

            draw();
        }

        // Drawing Logic
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const eyeX = canvas.width - 100;
            const eyeY = canvas.height / 2;
            const objectX = eyeX - state.distance;
            const objectY = eyeY;

            // 1. Draw Environment (Light Source for Non-Luminous)
            if (state.objectType === 'non-luminous' && !state.isInfinite) {
                drawLamp(100, 50);
                // Draw ray from lamp to object
                ctx.beginPath();
                ctx.moveTo(100, 50);
                ctx.lineTo(objectX, objectY);
                ctx.strokeStyle = "rgba(255, 255, 200, 0.6)";
                ctx.lineWidth = 2;
                ctx.setLineDash([]);
                ctx.stroke();
                
                // Arrow
                const midX = (100 + objectX) / 2;
                const midY = (50 + objectY) / 2;
                const angle = Math.atan2(objectY - 50, objectX - 100);

                ctx.save();
                ctx.translate(midX, midY);
                ctx.rotate(angle);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-10, -5);
                ctx.lineTo(-10, 5);
                ctx.closePath();
                ctx.fillStyle = "rgba(255, 255, 200, 1)";
                ctx.fill();
                ctx.restore();
                
                ctx.fillStyle = "#FFF";
                ctx.font = "14px Arial";
                ctx.fillText(t('canvasLightSource'), 80, 40);
            }

            // 2. Draw Rays
            ctx.globalCompositeOperation = 'screen';
            const pupilTopY = eyeY - (state.pupilSize / 2);
            const pupilBottomY = eyeY + (state.pupilSize / 2);

            if (state.isInfinite) {
                ctx.fillStyle = "rgba(255, 255, 0, 0.15)";
                ctx.fillRect(0, pupilTopY, eyeX, state.pupilSize);
                
                ctx.strokeStyle = "rgba(255, 255, 0, 0.6)";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, pupilTopY);
                ctx.lineTo(eyeX, pupilTopY);
                ctx.moveTo(0, pupilBottomY);
                ctx.lineTo(eyeX, pupilBottomY);
                ctx.moveTo(0, eyeY);
                ctx.lineTo(eyeX, eyeY);
                ctx.stroke();
                
                drawArrow(ctx, 300, pupilTopY, 20);
                drawArrow(ctx, 300, pupilBottomY, 20);

            } else {
                ctx.beginPath();
                ctx.moveTo(objectX, objectY);
                ctx.lineTo(eyeX, pupilTopY);
                ctx.lineTo(eyeX, pupilBottomY);
                ctx.closePath();
                ctx.fillStyle = "rgba(255, 255, 0, 0.2)";
                ctx.fill();

                ctx.beginPath();
                ctx.moveTo(objectX, objectY);
                ctx.lineTo(eyeX, pupilTopY);
                ctx.moveTo(objectX, objectY);
                ctx.lineTo(eyeX, pupilBottomY);
                
                ctx.strokeStyle = "rgba(255, 255, 0, 0.8)";
                ctx.lineWidth = 2;
                ctx.stroke();

                const midX = (objectX + eyeX) / 2;
                const midTopY = (objectY + pupilTopY) / 2;
                const midBotY = (objectY + pupilBottomY) / 2;
                drawArrow(ctx, midX, midTopY, 0);
                drawArrow(ctx, midX, midBotY, 0);
            }

            ctx.globalCompositeOperation = 'source-over';

            // 3. Draw Object
            if (!state.isInfinite) {
                if (state.objectType === 'luminous') {
                    drawCandle(objectX, objectY);
                } else {
                    drawApple(objectX, objectY);
                }
            } else {
                ctx.fillStyle = "#FFF";
                ctx.font = "20px Arial";
                ctx.textAlign = "left";
                ctx.fillText(t('canvasInfiniteHint'), 20, eyeY - 50);
            }

            // 4. Draw Eye
            drawEye(eyeX, eyeY, state.pupilSize);
        }

        // Graphic Helpers
        function drawEye(x, y, aperture) {
            ctx.save();
            
            ctx.beginPath();
            ctx.arc(x + 40, y, 70, 0, Math.PI * 2);
            ctx.fillStyle = "#E5E7EB";
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(x, y - 80);
            ctx.quadraticCurveTo(x - 20, y, x, y + 80);
            ctx.strokeStyle = "#9CA3AF";
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.fillStyle = "#60A5FA";
            
            ctx.beginPath();
            ctx.moveTo(x, y - 80);
            ctx.quadraticCurveTo(x - 15, y - 40, x, y - (aperture/2));
            ctx.lineTo(x + 10, y - (aperture/2));
            ctx.lineTo(x + 10, y - 80);
            ctx.fill();

            ctx.beginPath();
            ctx.moveTo(x, y + 80);
            ctx.quadraticCurveTo(x - 15, y + 40, x, y + (aperture/2));
            ctx.lineTo(x + 10, y + (aperture/2));
            ctx.lineTo(x + 10, y + 80);
            ctx.fill();

            ctx.beginPath();
            ctx.arc(x + 40, y, 65, -Math.PI/2, Math.PI/2, false);
            ctx.strokeStyle = "#F87171";
            ctx.lineWidth = 4;
            ctx.stroke();
            
            ctx.fillStyle = "#FFFFFF";
            ctx.font = "14px Arial";
            
            ctx.textAlign = "left";
            ctx.fillText(t('canvasRetina'), x + 120, y + 5);
            
            ctx.textAlign = "center";
            ctx.fillText(t('canvasPupil'), x, y + 105);

            ctx.restore();
        }

        function drawCandle(x, y) {
            ctx.save();
            ctx.translate(x, y);
            
            ctx.fillStyle = "#DDDDDD";
            ctx.fillRect(-10, 10, 20, 50);
            
            ctx.fillStyle = "#333";
            ctx.fillRect(-1, 0, 2, 10);

            ctx.beginPath();
            ctx.moveTo(0, 0);
            ctx.quadraticCurveTo(-10, -15, 0, -30);
            ctx.quadraticCurveTo(10, -15, 0, 0);
            ctx.fillStyle = "#F59E0B";
            ctx.fill();
            
            ctx.beginPath();
            ctx.arc(0, -15, 20, 0, Math.PI * 2);
            ctx.fillStyle = "rgba(255, 200, 0, 0.3)";
            ctx.fill();

            ctx.fillStyle = "#FFF";
            ctx.font = "14px Arial";
            ctx.textAlign = "center";
            ctx.fillText(t('canvasObjectLuminous'), 0, 80);

            ctx.restore();
        }

        function drawApple(x, y) {
            ctx.save();
            ctx.translate(x, y);

            ctx.beginPath();
            ctx.arc(0, 10, 20, 0, Math.PI*2);
            ctx.fillStyle = "#EF4444";
            ctx.fill();
            
            ctx.beginPath();
            ctx.ellipse(5, -10, 8, 4, Math.PI/4, 0, Math.PI*2);
            ctx.fillStyle = "#10B981";
            ctx.fill();

            ctx.fillStyle = "#FFF";
            ctx.font = "14px Arial";
            ctx.textAlign = "center";
            ctx.fillText(t('canvasObjectNonLuminous'), 0, 50);

            ctx.restore();
        }

        function drawLamp(x, y) {
            ctx.save();
            ctx.translate(x, y);
            
            ctx.beginPath();
            ctx.arc(0, 0, 15, 0, Math.PI*2);
            ctx.fillStyle = "#FEF3C7";
            ctx.fill();
            ctx.strokeStyle = "#F59E0B";
            ctx.lineWidth = 2;
            ctx.stroke();

            for(let i=0; i<8; i++) {
                ctx.rotate(Math.PI/4);
                ctx.beginPath();
                ctx.moveTo(20, 0);
                ctx.lineTo(30, 0);
                ctx.stroke();
            }

            ctx.restore();
        }

        function drawArrow(context, x, y, size) {
            context.beginPath();
            context.moveTo(x, y);
            context.lineTo(x - 10, y - 5);
            context.moveTo(x, y);
            context.lineTo(x - 10, y + 5);
            context.strokeStyle = "rgba(255,255,0,1)";
            context.lineWidth = 2;
            context.stroke();
        }

        window.addEventListener('load', init);

    </script>
</body>
</html>