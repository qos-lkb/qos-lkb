<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç´°èƒçµæ§‹ Structure of Cell</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Noto Sans TC & Inter) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
        }
        /* Custom animations for interaction feedback */
        .selected-part {
            filter: drop-shadow(0 0 6px rgba(234, 88, 12, 0.6));
            stroke: #ea580c !important; /* Orange-600 */
            stroke-width: 4px !important;
            transition: all 0.3s ease;
        }
        /* Highlighting the text label when active - Black Border White Text */
        .selected-text {
            fill: white !important;
            stroke: black !important;
            stroke-width: 1px;
            font-weight: 900;
            font-size: 17px; 
            paint-order: stroke;
            stroke-linejoin: round;
            filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.5));
        }
        .hover-part:hover {
            cursor: pointer;
            filter: drop-shadow(0 0 4px rgba(0, 0, 0, 0.1));
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* SVG Text styling */
        .label-text {
            font-size: 15px;
            font-weight: bold;
            fill: #1f2937;
            pointer-events: none;
            text-shadow: 1px 1px 0 #fff, -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff;
            transition: fill 0.2s, stroke 0.2s;
        }
        .connector-line {
            stroke: #374151;
            stroke-width: 2;
            fill: none;
        }
        /* Sidebar active state */
        .nav-active {
            background-color: white;
            color: black !important;
            border-right: 4px solid #059669; /* emerald-600 */
        }
        /* Table Styles */
        .compare-table th, .compare-table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: center;
        }
        .compare-table th {
            background-color: #f0fdf4; /* green-50 */
            color: #166534; /* green-800 */
            font-weight: bold;
        }
        .compare-table tr:nth-child(even) {
            background-color: #f9fafb; /* gray-50 */
        }
        .check-icon { color: #16a34a; font-weight: bold; }
        .cross-icon { color: #dc2626; font-weight: bold; }
        /* Custom Scrollbar for the floating card */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 4px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-emerald-600 text-white p-4 shadow-md flex-shrink-0 z-20 flex justify-between items-center">
        <div class="flex items-center gap-3">
            <span class="text-2xl">ğŸ”¬</span>
            <!-- Updated Title -->
            <h1 id="app-title" class="text-xl md:text-2xl font-bold tracking-wide">ç´°èƒæ§‹é€  Structure of Cell</h1>
        </div>
        
        <div class="flex items-center gap-3">
            <!-- Compare Button -->
            <button onclick="openModal()" class="flex items-center gap-2 bg-white text-emerald-700 px-3 py-1.5 md:px-4 md:py-2 rounded-lg font-bold shadow hover:bg-emerald-50 transition transform hover:scale-105 text-sm md:text-base">
                <span>ğŸ“Š</span>
                <span id="btn-compare-text" class="hidden md:inline">æ¯”è¼ƒåœ–è¡¨</span>
            </button>
            
            <!-- Language Toggle -->
            <button onclick="toggleLanguage()" class="bg-emerald-800 hover:bg-emerald-900 text-white px-3 py-1.5 md:px-4 md:py-2 rounded-lg font-bold shadow text-xs md:text-sm border border-emerald-500 whitespace-nowrap">
                <span id="lang-btn-text">ä¸­ / EN</span>
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="flex flex-1 overflow-hidden relative">

        <!-- Sidebar Navigation (Fixed Left) -->
        <nav class="w-24 md:w-32 bg-gray-800 flex flex-col items-center py-6 gap-4 shadow-lg z-20 flex-shrink-0 h-full">
            <button onclick="switchMode('plant')" id="btn-plant" class="nav-btn w-full py-4 flex flex-col items-center gap-2 text-gray-400 hover:text-white transition-colors nav-active">
                <span class="text-3xl">ğŸŒ±</span>
                <span id="nav-plant-text" class="text-xs md:text-sm font-bold text-center">æ¤ç‰©ç´°èƒ</span>
            </button>
            <button onclick="switchMode('animal')" id="btn-animal" class="nav-btn w-full py-4 flex flex-col items-center gap-2 text-gray-400 hover:text-white transition-colors">
                <span class="text-3xl">ğŸ¦</span>
                <span id="nav-animal-text" class="text-xs md:text-sm font-bold text-center">å‹•ç‰©ç´°èƒ</span>
            </button>
        </nav>

        <!-- Content Area (Diagram + Floating Info) -->
        <main class="flex-1 relative bg-gray-50 overflow-hidden">
            
            <!-- 1. Interactive Diagram Container (Full Screen Layer) -->
            <div class="absolute inset-0 w-full h-full flex justify-center items-center p-4 overflow-hidden z-0">
                
                <div id="hint-bubble" class="absolute top-4 left-4 bg-yellow-100 text-yellow-800 text-sm px-3 py-1 rounded-lg shadow animate-pulse pointer-events-none z-10">
                    ğŸ‘† é»æ“Šæ¨™ç¤ºæˆ–æ§‹é€ ä»¥æŸ¥çœ‹
                </div>

                <!-- PLANT CELL VIEW -->
                <div id="view-plant" class="w-full h-full flex justify-center items-center transition-opacity duration-300">
                    <svg viewBox="0 0 800 450" class="w-full h-full max-w-5xl select-none" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(200, 0)">
                            <!-- 1. Cell Wall -->
                            <g id="plant-cell-wall" class="hover-part group" onclick="selectPart('cell-wall')">
                                <path d="M50,80 Q50,30 100,30 H500 Q550,30 550,80 V370 Q550,420 500,420 H100 Q50,420 50,370 Z" fill="#4ade80" stroke="#15803d" stroke-width="6" />
                                <text id="label-plant-cell-wall" x="-190" y="80" class="label-text" text-anchor="start">1. ç´°èƒå£</text>
                                <!-- Line extended right from 45 to 50 to touch the wall -->
                                <line x1="-50" y1="75" x2="50" y2="75" class="connector-line" />
                            </g>
                            <!-- 2. Cell Membrane -->
                            <g id="plant-cell-membrane" class="hover-part" onclick="selectPart('cell-membrane')">
                                <path d="M65,85 Q65,45 105,45 H495 Q535,45 535,85 V365 Q535,405 495,405 H105 Q65,405 65,365 Z" fill="#dcfce7" stroke="#fbbf24" stroke-width="3" />
                                <text id="label-plant-cell-membrane" x="-190" y="120" class="label-text" text-anchor="start">2. ç´°èƒè†œ</text>
                                <!-- Line extended right from 60 to 65 to touch the membrane -->
                                <line x1="-50" y1="115" x2="65" y2="115" class="connector-line" />
                            </g>
                            <!-- 7. Cytoplasm -->
                            <g id="plant-cytoplasm" class="hover-part" onclick="selectPart('cytoplasm')">
                                <path d="M70,90 Q70,50 110,50 H490 Q530,50 530,90 V360 Q530,400 490,400 H110 Q70,400 70,360 Z" fill="transparent" />
                                <text id="label-plant-cytoplasm" x="-190" y="380" class="label-text" text-anchor="start">7. ç´°èƒè³ª</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="375" x2="80" y2="375" class="connector-line" />
                            </g>
                            <!-- 4. Vacuole -->
                            <g id="plant-vacuole" class="hover-part" onclick="selectPart('vacuole')">
                                <path d="M220,150 Q350,130 440,180 Q480,250 450,330 Q350,380 240,350 Q170,280 220,150 Z" fill="#bae6fd" stroke="#0ea5e9" stroke-width="2" opacity="0.9" />
                                <text id="label-plant-vacuole" x="-190" y="250" class="label-text" text-anchor="start">4. æ¶²æ³¡</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="245" x2="250" y2="245" class="connector-line" />
                            </g>
                            <!-- 3. Nucleus -->
                            <g id="plant-nucleus" class="hover-part" onclick="selectPart('nucleus')">
                                <circle cx="140" cy="160" r="35" fill="#e9d5ff" stroke="#9333ea" stroke-width="3" />
                                <circle cx="140" cy="160" r="9" fill="#9333ea" opacity="0.5" />
                                <text id="label-plant-nucleus" x="-190" y="160" class="label-text" text-anchor="start">3. ç´°èƒæ ¸</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="155" x2="105" y2="155" class="connector-line" />
                            </g>
                            <!-- 5. Mitochondrion -->
                            <g id="plant-mitochondrion" class="hover-part" onclick="selectPart('mitochondrion')">
                                <g transform="translate(300, 380) scale(0.7) rotate(0)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <!-- Moved top-right mitochondrion left and down (from 420, 70 to 380, 100) -->
                                <g transform="translate(380, 100) scale(0.7) rotate(-45)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <!-- Moved up from 295 to 280 to align center with the label line -->
                                <g transform="translate(110, 280) scale(0.7) rotate(90)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <g transform="translate(510, 300) scale(0.7) rotate(90)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <text id="label-plant-mitochondrion" x="-190" y="300" class="label-text" text-anchor="start">5. ç·šç²’é«”</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="295" x2="110" y2="295" class="connector-line" />
                            </g>
                            <!-- 6. Chloroplasts -->
                            <g id="plant-chloroplast" class="hover-part" onclick="selectPart('chloroplast')">
                                <ellipse cx="460" cy="100" rx="16" ry="10" fill="#16a34a" stroke="#14532d" stroke-width="2" transform="rotate(-10 460 100)"/>
                                <ellipse cx="490" cy="200" rx="16" ry="10" fill="#16a34a" stroke="#14532d" stroke-width="2" transform="rotate(80 490 200)"/>
                                <ellipse cx="450" cy="350" rx="16" ry="10" fill="#16a34a" stroke="#14532d" stroke-width="2" transform="rotate(30 450 350)"/>
                                <ellipse cx="150" cy="330" rx="16" ry="10" fill="#16a34a" stroke="#14532d" stroke-width="2" transform="rotate(-20 150 330)"/>
                                <ellipse cx="180" cy="90" rx="16" ry="10" fill="#16a34a" stroke="#14532d" stroke-width="2" transform="rotate(10 180 90)"/>
                                <text id="label-plant-chloroplast" x="-190" y="335" class="label-text" text-anchor="start">6. è‘‰ç¶ é«”</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="330" x2="135" y2="330" class="connector-line" />
                            </g>
                        </g>
                    </svg>
                </div>

                <!-- ANIMAL CELL VIEW -->
                <div id="view-animal" class="w-full h-full flex justify-center items-center hidden transition-opacity duration-300">
                    <svg viewBox="0 0 800 450" class="w-full h-full max-w-5xl select-none" preserveAspectRatio="xMidYMid meet">
                        <g transform="translate(200, 0)">
                            
                            <!-- 1. Cell Membrane (Irregular Shape) -->
                            <g id="animal-cell-membrane" class="hover-part" onclick="selectPart('cell-membrane')">
                                <path d="M100,150 Q80,50 250,60 Q400,30 480,100 Q550,150 520,280 Q480,380 300,390 Q120,400 100,280 Q80,200 100,150 Z" 
                                      fill="#ffe4e6" stroke="#fbbf24" stroke-width="3" />
                                <text id="label-animal-cell-membrane" x="-190" y="150" class="label-text" text-anchor="start">1. ç´°èƒè†œ</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="145" x2="100" y2="145" class="connector-line" />
                            </g>

                            <!-- 2. Cytoplasm (Inside click) -->
                            <g id="animal-cytoplasm" class="hover-part" onclick="selectPart('cytoplasm')">
                                <path d="M105,155 Q85,55 250,65 Q400,35 480,105 Q550,155 520,280 Q480,375 300,385 Q120,395 105,280 Q85,200 105,155 Z" 
                                      fill="transparent" />
                                <text id="label-animal-cytoplasm" x="-190" y="350" class="label-text" text-anchor="start">4. ç´°èƒè³ª</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="345" x2="200" y2="345" class="connector-line" />
                            </g>

                            <!-- 3. Nucleus (Central) -->
                            <g id="animal-nucleus" class="hover-part" onclick="selectPart('nucleus')">
                                <circle cx="300" cy="225" r="45" fill="#e9d5ff" stroke="#9333ea" stroke-width="3" />
                                <circle cx="300" cy="225" r="12" fill="#9333ea" opacity="0.5" />
                                <text id="label-animal-nucleus" x="-190" y="225" class="label-text" text-anchor="start">2. ç´°èƒæ ¸</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="220" x2="255" y2="220" class="connector-line" />
                            </g>

                            <!-- 4. Mitochondrion (Scattered) -->
                            <g id="animal-mitochondrion" class="hover-part" onclick="selectPart('mitochondrion')">
                                <!-- Top -->
                                <g transform="translate(300, 100) scale(0.8) rotate(10)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <!-- Right -->
                                <g transform="translate(450, 200) scale(0.8) rotate(80)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <!-- Bottom -->
                                <g transform="translate(350, 320) scale(0.8) rotate(-20)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>
                                <!-- Left (Target for Label) -->
                                <g transform="translate(180, 280) scale(0.8) rotate(-45)"><path d="M0,0 Q20,-20 40,0 Q20,20 0,0" fill="#fca5a5" stroke="#ef4444" stroke-width="3" /><path d="M5,0 L35,0" stroke="#ef4444" stroke-width="1.5" stroke-dasharray="3" fill="none" /></g>

                                <text id="label-animal-mitochondrion" x="-190" y="280" class="label-text" text-anchor="start">3. ç·šç²’é«”</text>
                                <!-- Line extended left to -50 -->
                                <line x1="-50" y1="275" x2="195" y2="275" class="connector-line" />
                            </g>

                        </g>
                    </svg>
                </div>
            </div>

            <!-- 2. Floating Info Panel (Bottom Right) -->
            <!-- Use pointer-events-none on wrapper to allow clicking SVG behind the empty space -->
            <div class="absolute bottom-0 left-0 right-0 md:left-auto md:top-auto md:bottom-6 md:right-6 md:w-96 max-h-[45vh] md:max-h-[80vh] z-30 flex flex-col pointer-events-none transition-all duration-300">
                
                <!-- Inner card takes pointer events -->
                <div class="pointer-events-auto bg-white/95 backdrop-blur-md shadow-[0_-5px_20px_-5px_rgba(0,0,0,0.1)] md:shadow-2xl rounded-t-2xl md:rounded-2xl border border-gray-200/50 flex flex-col h-full overflow-hidden transition-all duration-300">
                    
                    <div class="p-6 overflow-y-auto custom-scrollbar">
                        
                        <div id="info-card" class="transition-all duration-300">
                            <!-- Default State -->
                            <div id="default-state" class="text-center py-6 text-gray-500">
                                <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path></svg>
                                <p id="default-title" class="text-lg font-bold">è«‹é»æ“Šå·¦å´æ¨™ç¤ºæˆ–æ§‹é€ </p>
                                <p id="default-subtitle" class="mt-1 text-sm">é»é¸æ§‹é€ åç¨±ï¼ŒæŸ¥çœ‹å®ƒçš„åŠŸèƒ½ã€‚</p>
                            </div>

                            <!-- Active State (Hidden by default) -->
                            <div id="active-state" class="hidden">
                                <div class="flex items-center justify-between mb-4 border-b pb-2">
                                    <h2 id="part-title" class="text-2xl font-black text-emerald-800 tracking-wider">æ§‹é€ åç¨±</h2>
                                    <span id="part-icon" class="text-4xl">ğŸ”¬</span>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="bg-blue-50 p-4 rounded-xl border-l-4 border-blue-500">
                                        <h3 id="header-structure" class="text-sm font-bold text-blue-600 uppercase mb-1">æ§‹é€ ç‰¹å¾µ (Structure)</h3>
                                        <p id="part-structure" class="text-gray-800 text-base leading-relaxed">...</p>
                                    </div>

                                    <div class="bg-orange-50 p-4 rounded-xl border-l-4 border-orange-500">
                                        <h3 id="header-function" class="text-sm font-bold text-orange-600 uppercase mb-1">åŠŸèƒ½ (Function)</h3>
                                        <p id="part-function" class="text-gray-800 text-base leading-relaxed">...</p>
                                    </div>

                                    <div class="mt-4 pt-4 border-t border-gray-100">
                                        <p class="text-sm text-gray-500 italic">
                                            <span id="header-analogy">ğŸ’¡ æ¯”å–»ï¼š</span><span id="analogy-text">...</span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Legend for Mobile (Hidden on desktop since we have floating panel) -->
                        <div id="mobile-legend" class="mt-6 grid grid-cols-2 gap-2 md:hidden">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- COMPARISON MODAL -->
    <div id="compare-modal" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden flex justify-center items-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col transform transition-transform duration-300 scale-100">
            <!-- Modal Header -->
            <div class="bg-emerald-600 text-white p-4 flex justify-between items-center shadow-md">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">ğŸ“Š</span>
                    <h2 id="modal-title" class="text-xl md:text-2xl font-bold">æ¤ç‰©ç´°èƒ vs å‹•ç‰©ç´°èƒ</h2>
                </div>
                <button onclick="closeModal()" class="text-white hover:bg-emerald-700 p-1 rounded-full w-8 h-8 flex items-center justify-center font-bold text-xl transition-colors">&times;</button>
            </div>
            
            <!-- Modal Content (Scrollable) -->
            <div class="p-6 overflow-y-auto bg-gray-50">
                <table class="w-full compare-table text-sm md:text-base bg-white shadow-sm rounded-lg overflow-hidden">
                    <thead>
                        <tr>
                            <th id="th-feature" class="w-1/3 text-left">æ§‹é€  / ç‰¹å¾µ</th>
                            <th id="th-plant" class="w-1/3 text-emerald-800">ğŸŒ± æ¤ç‰©ç´°èƒ</th>
                            <th id="th-animal" class="w-1/3 text-orange-800">ğŸ¦ å‹•ç‰©ç´°èƒ</th>
                        </tr>
                    </thead>
                    <tbody id="modal-tbody" class="text-gray-700">
                        <!-- Populated by JS -->
                    </tbody>
                </table>
                <div class="mt-4 text-center text-sm text-gray-500">
                    <span id="modal-tip">ğŸ’¡ æç¤ºï¼šæ¤ç‰©ç´°èƒçš„ç´°èƒå£ã€è‘‰ç¶ é«”å’Œå¤§æ¶²æ³¡æ˜¯èˆ‡å‹•ç‰©ç´°èƒå€åˆ¥çš„ä¸»è¦ç‰¹å¾µã€‚</span>
                </div>
                <div class="mt-6 flex justify-center">
                    <button id="modal-close-btn" onclick="closeModal()" class="px-6 py-2 bg-gray-200 text-gray-700 font-bold rounded hover:bg-gray-300 transition-colors">é—œé–‰</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Internationalization (i18n) Data ---
        let currentLang = 'zh'; // 'zh' or 'en'

        const uiTranslations = {
            zh: {
                appTitle: "ç´°èƒæ§‹é€ æ¢ç´¢", // Keep original name as previously adjusted, user asked to change title in previous prompt to "ç´°èƒæ§‹é€  Structure of Cell"
                appTitle: "ç´°èƒçµæ§‹ Structure of Cell", // Updated per previous specific request
                levelBadge: "ä¸­ä¸€ç§‘å­¸ç´šåˆ¥",
                btnCompare: "æ¯”è¼ƒåœ–è¡¨",
                navPlant: "æ¤ç‰©ç´°èƒ",
                navAnimal: "å‹•ç‰©ç´°èƒ",
                hintBubble: "ğŸ‘† é»æ“Šæ¨™ç¤ºæˆ–æ§‹é€ ä»¥æŸ¥çœ‹",
                defaultTitle: "è«‹é»æ“Šå·¦å´æ¨™ç¤ºæˆ–æ§‹é€ ",
                defaultSubtitle: "é»é¸æ§‹é€ åç¨±ï¼ŒæŸ¥çœ‹å®ƒçš„åŠŸèƒ½ã€‚",
                headerStructure: "æ§‹é€ ç‰¹å¾µ (Structure)",
                headerFunction: "åŠŸèƒ½ (Function)",
                headerAnalogy: "ğŸ’¡ æ¯”å–»ï¼š",
                modalTitle: "æ¤ç‰©ç´°èƒ vs å‹•ç‰©ç´°èƒ",
                thFeature: "æ§‹é€  / ç‰¹å¾µ",
                thPlant: "ğŸŒ± æ¤ç‰©ç´°èƒ",
                thAnimal: "ğŸ¦ å‹•ç‰©ç´°èƒ",
                modalTip: "ğŸ’¡ æç¤ºï¼šæ¤ç‰©ç´°èƒçš„ç´°èƒå£ã€è‘‰ç¶ é«”å’Œå¤§æ¶²æ³¡æ˜¯èˆ‡å‹•ç‰©ç´°èƒå€åˆ¥çš„ä¸»è¦ç‰¹å¾µã€‚",
                modalClose: "é—œé–‰",
                svgLabels: {
                    'plant-cell-wall': "1. ç´°èƒå£",
                    'plant-cell-membrane': "2. ç´°èƒè†œ",
                    'plant-cytoplasm': "7. ç´°èƒè³ª",
                    'plant-vacuole': "4. æ¶²æ³¡",
                    'plant-nucleus': "3. ç´°èƒæ ¸",
                    'plant-mitochondrion': "5. ç·šç²’é«”",
                    'plant-chloroplast': "6. è‘‰ç¶ é«”",
                    'animal-cell-membrane': "1. ç´°èƒè†œ",
                    'animal-cytoplasm': "4. ç´°èƒè³ª",
                    'animal-nucleus': "2. ç´°èƒæ ¸",
                    'animal-mitochondrion': "3. ç·šç²’é«”"
                },
                tableRows: [
                    { feature: "1. å½¢ç‹€", plant: "è¦å‰‡ä¸”å›ºå®š", animal: "ä¸è¦å‰‡" },
                    { feature: "2. ç´°èƒå£", plant: "âœ“ æœ‰", animal: "âœ— ç„¡" },
                    { feature: "3. è‘‰ç¶ é«”", plant: "âœ“ æœ‰", animal: "âœ— ç„¡" },
                    { feature: "4. æ¶²æ³¡", plant: "âœ“ æœ‰ (å¤§è€Œä½æ–¼ä¸­å¤®)", animal: "âœ— ç„¡ (æˆ–æ¥µå°ä¸”æš«æ™‚æ€§)" },
                    { feature: "5. ç´°èƒè†œ", plant: "âœ“ æœ‰", animal: "âœ“ æœ‰" },
                    { feature: "6. ç´°èƒè³ª", plant: "âœ“ æœ‰", animal: "âœ“ æœ‰" },
                    { feature: "7. ç´°èƒæ ¸", plant: "âœ“ æœ‰ (é€šå¸¸åœ¨é‚Šç·£)", animal: "âœ“ æœ‰ (é€šå¸¸åœ¨ä¸­å¤®)" },
                    { feature: "8. ç·šç²’é«”", plant: "âœ“ æœ‰", animal: "âœ“ æœ‰" }
                ]
            },
            en: {
                appTitle: "Structure of Cell",
                levelBadge: "S1 Science Level",
                btnCompare: "Comparison",
                navPlant: "Plant Cell",
                navAnimal: "Animal Cell",
                hintBubble: "ğŸ‘† Click labels or structures to view",
                defaultTitle: "Select a structure",
                defaultSubtitle: "Click on a part name to see its function.",
                headerStructure: "Structure",
                headerFunction: "Function",
                headerAnalogy: "ğŸ’¡ Analogy: ",
                modalTitle: "Plant Cell vs Animal Cell",
                thFeature: "Feature",
                thPlant: "ğŸŒ± Plant Cell",
                thAnimal: "ğŸ¦ Animal Cell",
                modalTip: "ğŸ’¡ Tip: Cell wall, chloroplasts, and large vacuole are key differences.",
                modalClose: "Close",
                svgLabels: {
                    'plant-cell-wall': "1. Cell Wall",
                    'plant-cell-membrane': "2. Cell Membrane",
                    'plant-cytoplasm': "7. Cytoplasm",
                    'plant-vacuole': "4. Vacuole",
                    'plant-nucleus': "3. Nucleus",
                    'plant-mitochondrion': "5. Mitochondrion",
                    'plant-chloroplast': "6. Chloroplast",
                    'animal-cell-membrane': "1. Cell Membrane",
                    'animal-cytoplasm': "4. Cytoplasm",
                    'animal-nucleus': "2. Nucleus",
                    'animal-mitochondrion': "3. Mitochondrion"
                },
                tableRows: [
                    { feature: "1. Shape", plant: "Regular & Fixed", animal: "Irregular" },
                    { feature: "2. Cell Wall", plant: "âœ“ Present", animal: "âœ— Absent" },
                    { feature: "3. Chloroplasts", plant: "âœ“ Present", animal: "âœ— Absent" },
                    { feature: "4. Vacuole", plant: "âœ“ Present (Large & Central)", animal: "âœ— Absent (or very small)" },
                    { feature: "5. Cell Membrane", plant: "âœ“ Present", animal: "âœ“ Present" },
                    { feature: "6. Cytoplasm", plant: "âœ“ Present", animal: "âœ“ Present" },
                    { feature: "7. Nucleus", plant: "âœ“ Present (Usually at side)", animal: "âœ“ Present (Usually central)" },
                    { feature: "8. Mitochondrion", plant: "âœ“ Present", animal: "âœ“ Present" }
                ]
            }
        };

        // Scientific Data Store (Bilingual)
        const scientificData = {
            plant: {
                'cell-wall': {
                    icon: 'ğŸ§±',
                    zh: { name: 'ç´°èƒå£ (Cell Wall)', structure: 'ä½æ–¼æ¤ç‰©ç´°èƒæœ€å¤–å±¤ï¼Œåšè€Œå …ç¡¬ï¼Œä¸»è¦ç”±çº–ç¶­ç´ çµ„æˆã€‚', function: 'ä¿è­·ç´°èƒä¸¦æä¾›æ”¯æ’ï¼Œç¶­æŒç´°èƒå½¢ç‹€ã€‚', analogy: 'å°±åƒæ˜¯å­¸æ ¡çš„åœç‰†ã€‚' },
                    en: { name: 'Cell Wall', structure: 'Outermost layer of plant cells. Thick and rigid, made of cellulose.', function: 'Protects and supports the cell, maintaining its shape.', analogy: 'Like the school fence/walls.' }
                },
                'cell-membrane': {
                    icon: 'ğŸ›¡ï¸',
                    zh: { name: 'ç´°èƒè†œ (Cell Membrane)', structure: 'ç·Šè²¼åœ¨ç´°èƒå£å…§å´çš„ä¸€å±¤è–„è†œã€‚å…·é¸æ“‡æ€§é€æ€§ã€‚', function: 'æ§åˆ¶ç‰©è³ªé€²å‡ºç´°èƒï¼Œå°‡ç´°èƒèˆ‡å¤–ç•Œéš”é–‹ã€‚', analogy: 'å°±åƒæ˜¯å­¸æ ¡çš„æ ¡é–€åŠä¿å®‰ã€‚' },
                    en: { name: 'Cell Membrane', structure: 'Thin layer inside the cell wall. Differentially permeable.', function: 'Controls substance entry/exit, separating cell from outside.', analogy: 'Like the school gate and security guard.' }
                },
                'cytoplasm': {
                    icon: 'ğŸ’§',
                    zh: { name: 'ç´°èƒè³ª (Cytoplasm)', structure: 'æœå‡ç‹€ç‰©è³ªï¼Œå«æœ‰æ°´ã€è›‹ç™½è³ªç­‰ã€‚', function: 'è¨±å¤šåŒ–å­¸åæ‡‰é€²è¡Œçš„åœ°æ–¹ã€‚', analogy: 'å°±åƒæ˜¯æ ¡åœ’è£¡çš„ç©ºé–“ã€‚' },
                    en: { name: 'Cytoplasm', structure: 'Jelly-like substance containing water and proteins.', function: 'Site where many chemical reactions take place.', analogy: 'Like the open space in the campus.' }
                },
                'nucleus': {
                    icon: 'ğŸ§ ',
                    zh: { name: 'ç´°èƒæ ¸ (Nucleus)', structure: 'å‘ˆçƒç‹€ï¼Œå«æœ‰éºå‚³ç‰©è³ª(DNA)ã€‚', function: 'æ§åˆ¶ç´°èƒæ´»å‹•ï¼Œä¸¦å¸¶æœ‰éºå‚³è¨Šæ¯ã€‚', analogy: 'å°±åƒæ˜¯æ ¡é•·å®¤æˆ–å¤§è…¦ã€‚' },
                    en: { name: 'Nucleus', structure: 'Spherical shape, contains genetic material (DNA).', function: 'Controls cell activities and carries genetic information.', analogy: 'Like the Principal\'s office or brain.' }
                },
                'chloroplast': {
                    icon: 'â˜€ï¸',
                    zh: { name: 'è‘‰ç¶ é«” (Chloroplast)', structure: 'ç¶ è‰²é¡†ç²’ç‹€ï¼Œå«æœ‰è‘‰ç¶ ç´ ã€‚', function: 'é€²è¡Œå…‰åˆä½œç”¨ï¼Œè£½é€ é£Ÿç‰©ã€‚', analogy: 'å°±åƒæ˜¯é£Ÿå ‚å»šæˆ¿ã€‚' },
                    en: { name: 'Chloroplast', structure: 'Green granules containing chlorophyll.', function: 'Conducts photosynthesis to make food.', analogy: 'Like the canteen kitchen.' }
                },
                'vacuole': {
                    icon: 'ğŸˆ',
                    zh: { name: 'æ¶²æ³¡ (Vacuole)', structure: 'æ¤ç‰©ç´°èƒé€šå¸¸æœ‰ä¸€å€‹ä¸­å¤®å¤§æ¶²æ³¡ï¼Œå«ç´°èƒæ¶²ã€‚', function: 'å„²å­˜æ°´åˆ†å’Œç‰©è³ªï¼Œæä¾›æ”¯æ’ã€‚', analogy: 'å°±åƒæ˜¯å¤§å‹å„²æ°´åº«ã€‚' },
                    en: { name: 'Vacuole', structure: 'Large central vacuole containing cell sap.', function: 'Stores water and substances, provides support (turgidity).', analogy: 'Like a large water reservoir.' }
                },
                'mitochondrion': {
                    icon: 'ğŸ”‹',
                    zh: { name: 'ç·šç²’é«” (Mitochondrion)', structure: 'ç´°å°çš„æ£’ç‹€æ§‹é€ ã€‚', function: 'é€²è¡Œå‘¼å¸ä½œç”¨ï¼Œé‡‹æ”¾èƒ½é‡ã€‚ã€Œç´°èƒç™¼é›»å» ã€ã€‚', analogy: 'å°±åƒæ˜¯ç™¼é›»æ©Ÿæˆ¿ã€‚' },
                    en: { name: 'Mitochondrion', structure: 'Small rod-shaped structures.', function: 'Conducts respiration to release energy. "Powerhouse".', analogy: 'Like the power generator room.' }
                }
            },
            animal: {
                'cell-membrane': {
                    icon: 'ğŸ›¡ï¸',
                    zh: { name: 'ç´°èƒè†œ (Cell Membrane)', structure: 'ä½æ–¼å‹•ç‰©ç´°èƒæœ€å¤–å±¤çš„è–„è†œã€‚å…·é¸æ“‡æ€§é€æ€§ã€‚', function: 'æ§åˆ¶ç‰©è³ªé€²å‡ºï¼ŒåŒ…åœç´°èƒè³ªã€‚', analogy: 'å°±åƒæ˜¯çš®è†šæˆ–é‚Šå¢ƒæª¢æŸ¥ç«™ã€‚' },
                    en: { name: 'Cell Membrane', structure: 'Outermost layer of animal cells. Differentially permeable.', function: 'Controls entry/exit, encloses cytoplasm.', analogy: 'Like skin or border checkpoint.' }
                },
                'cytoplasm': {
                    icon: 'ğŸ’§',
                    zh: { name: 'ç´°èƒè³ª (Cytoplasm)', structure: 'æœå‡ç‹€ç‰©è³ªï¼Œå¡«æ»¿ç´°èƒå…§éƒ¨ã€‚', function: 'æä¾›åŒ–å­¸åæ‡‰çš„å ´æ‰€ï¼Œæ‰¿è¼‰ç´°èƒå™¨ã€‚', analogy: 'å°±åƒæ˜¯å……æ»¿æ°´çš„æœå‡ã€‚' },
                    en: { name: 'Cytoplasm', structure: 'Jelly-like substance filling the cell.', function: 'Site for chemical reactions, holds organelles.', analogy: 'Like jelly filled with water.' }
                },
                'nucleus': {
                    icon: 'ğŸ§ ',
                    zh: { name: 'ç´°èƒæ ¸ (Nucleus)', structure: 'é€šå¸¸ä½æ–¼ç´°èƒä¸­å¤®ï¼Œå«æœ‰éºå‚³ç‰©è³ªã€‚', function: 'æ§åˆ¶ç´°èƒç”Ÿé•·å’Œä¿®å¾©ï¼Œå«æœ‰DNAã€‚', analogy: 'å°±åƒæ˜¯æŒ‡æ®ä¸­å¿ƒã€‚' },
                    en: { name: 'Nucleus', structure: 'Usually central, contains genetic material.', function: 'Controls growth and repair, contains DNA.', analogy: 'Like a command center.' }
                },
                'mitochondrion': {
                    icon: 'ğŸ”‹',
                    zh: { name: 'ç·šç²’é«” (Mitochondrion)', structure: 'æ•£ä½ˆåœ¨ç´°èƒè³ªä¸­çš„æ£’ç‹€æ§‹é€ ã€‚', function: 'é‡‹æ”¾èƒ½é‡ä¾›ç´°èƒæ´»å‹•ä½¿ç”¨ã€‚', analogy: 'å°±åƒæ˜¯é›»æ± ã€‚' },
                    en: { name: 'Mitochondrion', structure: 'Rod-shaped, scattered in cytoplasm.', function: 'Releases energy for cell activities.', analogy: 'Like batteries.' }
                }
            }
        };

        let currentMode = 'plant'; // 'plant' or 'animal'
        let currentSelectedId = null;

        // --- Logic ---

        function toggleLanguage() {
            currentLang = currentLang === 'zh' ? 'en' : 'zh';
            updateUI();
        }

        function updateUI() {
            const t = uiTranslations[currentLang];

            // Header & Static UI
            document.getElementById('app-title').innerText = t.appTitle;
            document.getElementById('btn-compare-text').innerText = t.btnCompare;
            document.getElementById('nav-plant-text').innerText = t.navPlant;
            document.getElementById('nav-animal-text').innerText = t.navAnimal;
            document.getElementById('hint-bubble').innerText = t.hintBubble;
            // document.getElementById('lang-btn-text').innerText = currentLang === 'zh' ? 'EN' : 'ä¸­'; // Removed dynamic text update
            
            // Info Card Static Text
            document.getElementById('default-title').innerText = t.defaultTitle;
            document.getElementById('default-subtitle').innerText = t.defaultSubtitle;
            document.getElementById('header-structure').innerText = t.headerStructure;
            document.getElementById('header-function').innerText = t.headerFunction;
            document.getElementById('header-analogy').innerText = t.headerAnalogy;
            
            // Modal Static Text
            document.getElementById('modal-title').innerText = t.modalTitle;
            document.getElementById('th-feature').innerText = t.thFeature;
            document.getElementById('th-plant').innerText = t.thPlant;
            document.getElementById('th-animal').innerText = t.thAnimal;
            document.getElementById('modal-tip').innerText = t.modalTip;
            document.getElementById('modal-close-btn').innerText = t.modalClose;

            // Update SVG Labels
            Object.keys(t.svgLabels).forEach(id => {
                const labelEl = document.getElementById('label-' + id);
                if(labelEl) labelEl.textContent = t.svgLabels[id];
            });

            // Update Modal Table Content
            updateModalTable();

            // Refresh Info Card if something is selected
            if (currentSelectedId) {
                selectPart(currentSelectedId); // Re-render current selection with new lang
            } else {
                renderMobileLegend(); // Refresh names in legend
            }
        }

        function updateModalTable() {
            const t = uiTranslations[currentLang];
            const tbody = document.getElementById('modal-tbody');
            tbody.innerHTML = '';

            t.tableRows.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.className = index % 2 === 1 ? 'bg-gray-50' : '';
                tr.innerHTML = `
                    <td class="font-bold border border-gray-200 p-3">${row.feature}</td>
                    <td class="border border-gray-200 p-3">${formatCheck(row.plant)}</td>
                    <td class="border border-gray-200 p-3">${formatCheck(row.animal)}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        function formatCheck(text) {
            // Helper to style check/cross marks
            return text.replace('âœ“', '<span class="check-icon">âœ“</span>')
                       .replace('âœ—', '<span class="cross-icon">âœ—</span>');
        }

        function switchMode(mode) {
            currentMode = mode;
            currentSelectedId = null;

            // UI Toggle
            const btnPlant = document.getElementById('btn-plant');
            const btnAnimal = document.getElementById('btn-animal');

            if (mode === 'plant') {
                btnPlant.classList.add('nav-active');
                btnPlant.classList.remove('text-gray-400');
                btnAnimal.classList.remove('nav-active');
                btnAnimal.classList.add('text-gray-400');
            } else {
                btnAnimal.classList.add('nav-active');
                btnAnimal.classList.remove('text-gray-400');
                btnPlant.classList.remove('nav-active');
                btnPlant.classList.add('text-gray-400');
            }

            // View Toggle
            if (mode === 'plant') {
                document.getElementById('view-plant').classList.remove('hidden');
                document.getElementById('view-animal').classList.add('hidden');
            } else {
                document.getElementById('view-plant').classList.add('hidden');
                document.getElementById('view-animal').classList.remove('hidden');
            }

            // Reset Info
            document.getElementById('default-state').classList.remove('hidden');
            document.getElementById('active-state').classList.add('hidden');

            renderMobileLegend();
        }

        function selectPart(partId) {
            const prefix = currentMode + '-';
            
            // Visual Updates
            document.querySelectorAll('.selected-part').forEach(el => el.classList.remove('selected-part'));
            document.querySelectorAll('.selected-text').forEach(el => el.classList.remove('selected-text'));

            const targetShape = document.getElementById(prefix + partId);
            if (targetShape) targetShape.classList.add('selected-part');

            const targetLabel = document.getElementById('label-' + prefix + partId);
            if (targetLabel) targetLabel.classList.add('selected-text');

            currentSelectedId = partId;

            // Data Retrieval
            const dataItem = scientificData[currentMode][partId];
            if (!dataItem) return;

            const content = dataItem[currentLang]; // Get content based on current lang

            // Speech Synthesis (Always read English name, or localized?)
            // User requested: "English name" specifically in previous turn.
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                // Always get the English name for speech regardless of UI language
                const englishNameForSpeech = scientificData[currentMode][partId]['en'].name;
                const utterance = new SpeechSynthesisUtterance(englishNameForSpeech);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            }

            // Update Info Panel
            document.getElementById('default-state').classList.add('hidden');
            document.getElementById('active-state').classList.remove('hidden');
            
            const infoCard = document.getElementById('info-card');
            infoCard.classList.remove('fade-in');
            void infoCard.offsetWidth;
            infoCard.classList.add('fade-in');

            document.getElementById('part-title').innerText = content.name;
            document.getElementById('part-icon').innerText = dataItem.icon;
            document.getElementById('part-structure').innerText = content.structure;
            document.getElementById('part-function').innerText = content.function;
            document.getElementById('analogy-text').innerText = content.analogy;

            if (window.innerWidth < 768) {
                // For mobile bottom sheet behavior
                // No scroll needed as it's fixed at bottom, but maybe bring focus
            }
        }

        function renderMobileLegend() {
            const container = document.getElementById('mobile-legend');
            container.innerHTML = ''; 
            
            const currentData = scientificData[currentMode];
            Object.keys(currentData).forEach(key => {
                const item = currentData[key];
                const content = item[currentLang];
                const btn = document.createElement('button');
                btn.className = "p-2 bg-white rounded shadow text-xs font-bold text-gray-700 border border-gray-200 truncate";
                // Simplified name for legend
                const shortName = content.name.split(' (')[0]; 
                btn.innerText = shortName;
                btn.onclick = () => selectPart(key);
                container.appendChild(btn);
            });
        }

        function openModal() {
            updateModalTable(); // Ensure table is up to date with lang
            const modal = document.getElementById('compare-modal');
            modal.classList.remove('hidden');
            setTimeout(() => { modal.classList.remove('opacity-0'); }, 10);
        }

        function closeModal() {
            const modal = document.getElementById('compare-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
        }

        document.getElementById('compare-modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // Initialize table and mobile legend on load
        updateModalTable();
        renderMobileLegend();
    </script>
</body>
</html>